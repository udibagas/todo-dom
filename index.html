<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo App</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <main>
      <h1>Todos</h1>

      <form id="taskForm">
        <input type="hidden" id="taskId" />
        <input
          type="text"
          placeholder="type here..."
          id="taskInput"
          name="newTodo"
        />
        <button id="addBtn" type="submit">Save Task</button>
      </form>

      <ul id="todoList">
        <!-- <li>
          <input type="checkbox" />
          <div class="todo">Belajar HTML</div>
          <button class="deleteBtn">Delete</button>
        </li> -->
      </ul>
    </main>

    <script>
      let tasks = [{ id: 1, name: "Belajar HTML" }];
      const todoListEl = document.querySelector("#todoList");
      const taskInputEl = document.querySelector("#taskInput");
      const taskIdEl = document.querySelector("#taskId");

      function renderTodo() {
        todoListEl.innerHTML = "";
        for (let i = 0; i < tasks.length; i++) {
          const task = tasks[i];
          const liEl = document.createElement("li");
          liEl.innerHTML = `
          <div class="todo">${task.name}</div>
          <button class="editBtn" onclick="editTask(${task.id})">Edit</button>
          <button class="deleteBtn" onclick="deleteTask(${task.id})">Delete</button>
          `;

          todoListEl.appendChild(liEl);
        }
      }

      const form = document.getElementsByTagName("form")[0];

      function handleSubmit(event) {
        event.preventDefault();

        if (taskIdEl.value) {
          updateTask(taskIdEl.value, taskInputEl.value);
        } else {
          let id = 1;

          if (tasks.length > 0) {
            id = tasks[tasks.length - 1].id + 1;
          }

          tasks.push({ id: id, name: taskInputEl.value });
        }

        // re-render todo list
        renderTodo();
        // reset form
        taskIdEl.value = "";
        taskInputEl.value = "";
      }

      function deleteTask(id) {
        const tmpTask = [];

        for (let i = 0; i < tasks.length; i++) {
          if (tasks[i].id !== id) {
            tmpTask.push(tasks[i]);
          }
        }

        tasks = tmpTask;
        renderTodo();
      }

      function editTask(id) {
        let task;

        for (let i = 0; i < tasks.length; i++) {
          if (tasks[i].id == id) {
            task = tasks[i];
            taskIdEl.value = task.id;
            taskInputEl.value = task.name;
            break;
          }
        }
      }

      function updateTask(id, name) {
        for (let i = 0; i < tasks.length; i++) {
          if (tasks[i].id == id) {
            tasks[i].name = name;
            break;
          }
        }
      }

      form.addEventListener("submit", handleSubmit);
      renderTodo();
    </script>
  </body>
</html>
